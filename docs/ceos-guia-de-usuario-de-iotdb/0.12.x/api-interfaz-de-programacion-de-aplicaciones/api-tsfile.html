<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API TsFile :: Guía de Usuario de IoTDB</title>
    <link rel="canonical" href="https://aumandaris.github.io/ceos-guia-de-usuario-de-iotdb/ceos-guia-de-usuario-de-iotdb/0.12.x/index.html/ceos-guia-de-usuario-de-iotdb/0.12.x/api-interfaz-de-programacion-de-aplicaciones/api-tsfile.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://aumandaris.github.io/ceos-guia-de-usuario-de-iotdb/ceos-guia-de-usuario-de-iotdb/0.12.x/index.html">
        <img src="/ceos-guia-de-usuario-de-iotdb/ceos-guia-de-usuario-de-iotdb/0.12.x/_images/ceos-logo.png" width="40">
        <span>Guía de Usuario de IoTDB<span>     
      </a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ceos-guia-de-usuario-de-iotdb" data-version="0.12.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Guía de Usuario de IoTDB</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introducción a IoTDB</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduccion-a-iotdb/que-es-iotdb.html">Qué es IoTDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduccion-a-iotdb/arquitectura.html">Arquitectura</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#introduccion-a-iotdb/escenario.adoc">Escenarios</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduccion-a-iotdb/caracteristicas.html">Características</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../introduccion-a-iotdb/publicacion.html">Publicación</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Inicio Rápido</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../inicio-rapido/inicio-rapido.html">Inicio Rápido</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../inicio-rapido/configuracion-de-ruta-de-almacenamiento.html">Configuración de Ruta de Almacenamiento</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../inicio-rapido/obtener-archivos-binarios-de-iotdb.html">Obtener Archivos Binarios de IoTDB</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Concepto de Datos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepto-de-datos/modelo-de-datos-y-terminologia.html">Modelo de Datos y Terminología</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepto-de-datos/tipo-de-datos.html">Tipo de Datos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepto-de-datos/codificacion.html">Codificación</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepto-de-datos/compresion.html">Compresión</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepto-de-datos/sdt.html">SDT</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Interfaz de Línea de Comandos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../interfaz-de-linea-de-comandos/interfaz-de-linea-de-comandos.html">Interfaz de Línea de Comandos</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Gestión de la Administración</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gestion-de-la-administracion/administracion.html">Administración</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lenguaje IoTDB-SQL</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lenguaje-iotdb-sql/ddl-lenguaje-de-definicion-de-datos.html">DDL (Lenguaje de Definición de Datos)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lenguaje-iotdb-sql/dml-lenguaje-de-manipulacion-de-datos.html">DML (Lenguaje de Manipulación de Datos)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lenguaje-iotdb-sql/comando-de-mantenimiento.html">Comando de Mantenimiento</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">API (Interfaz de Programación de Aplicaciones)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jdbc.html">JDBC</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="api-nativa.html">API Nativa</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="otros-lenguajes.html">Otros Lenguajes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="api-tsfile.html">API TsFile</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">UDF (Función Definida por el Usuario)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../udf-funcion-definida-por-el-usuario/udf-funcion-definida-por-el-usuario.html">Función Definida por el Usuario</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Protocolo de Servicio de Comunicación</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../protocolo-de-servicio-de-comunicacion/thrift.html">Thrift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../protocolo-de-servicio-de-comunicacion/mqtt.html">MQTT</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Guía de Usuario de IoTDB</span>
    <span class="version">0.12.x</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Guía de Usuario de IoTDB</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.12.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Guía de Usuario de IoTDB</a></li>
    <li>API (Interfaz de Programación de Aplicaciones)</li>
    <li><a href="api-tsfile.html">API TsFile</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/Aumandaris/ceos-guia-de-usuario-de-iotdb/edit/master/modules/ROOT/pages/api-interfaz-de-programacion-de-aplicaciones/api-tsfile.adoc">Editar esta página</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">API TsFile</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>TsFile es un formato de archivo de serie temporal que se utiliza en IoTDB. Esta sesión presenta el uso de este formato de archivo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instalación_de_la_biblioteca_tsfile"><a class="anchor" href="#_instalación_de_la_biblioteca_tsfile"></a>Instalación de la Biblioteca TsFile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hay dos formas de utilizar TsFile en su propio proyecto.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Usar como jarras: compila los códigos fuente y compila en jarras</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>git clone https://github.com/apache/iotdb.git
cd tsfile/
mvn clean package -Dmaven.test.skip=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego, todos las jarras están en la carpeta llamada <code>target/</code>. Importe <code>target/tsfile-0.12.0-jar-with-dependencies.jar</code> a su proyecto.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Úselo como una dependencia de maven:</p>
<div class="paragraph">
<p>Compile códigos fuente e impleméntelos en su repositorio local en tres pasos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtenga los códigos fuente</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>git clone https://github.com/apache/iotdb.git</code></pre>
</div>
</div>
</li>
<li>
<p>Compile los códigos fuente e impleméntelos</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>cd tsfile/
mvn clean install -Dmaven.test.skip=true</code></pre>
</div>
</div>
</li>
<li>
<p>Agregue dependencias en su proyecto:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> &lt;dependency&gt;
   &lt;groupId&gt;org.apache.iotdb&lt;/groupId&gt;
   &lt;artifactId&gt;tsfile&lt;/artifactId&gt;
   &lt;version&gt;0.10.0&lt;/version&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O puede descargar las dependencias del repositorio oficial de Maven:</p>
</div>
</li>
<li>
<p>Primero, busque su maven <code>settings.xml</code> en la ruta: <code>${username}\.m2\settings.xml</code>, agregue este <code>&lt;profile&gt; a &lt;profiles&gt;</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>  &lt;profile&gt;
       &lt;id&gt;allow-snapshots&lt;/id&gt;
          &lt;activation&gt;&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;&lt;/activation&gt;
       &lt;repositories&gt;
         &lt;repository&gt;
            &lt;id&gt;apache.snapshots&lt;/id&gt;
            &lt;name&gt;Apache Development Snapshot Repository&lt;/name&gt;
            &lt;url&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/url&gt;
            &lt;releases&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/releases&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;/snapshots&gt;
          &lt;/repository&gt;
       &lt;/repositories&gt;
     &lt;/profile&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Luego agregue dependencias a su proyecto:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> &lt;dependency&gt;
   &lt;groupId&gt;org.apache.iotdb&lt;/groupId&gt;
   &lt;artifactId&gt;tsfile&lt;/artifactId&gt;
   &lt;version&gt;0.10.0&lt;/version&gt;
 &lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uso_de_tsfile"><a class="anchor" href="#_uso_de_tsfile"></a>Uso de TsFile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Esta sección muestra los usos detallados de TsFile.</p>
</div>
<div class="paragraph">
<p><strong>Datos de Series de Tiempo</strong>:Los datos de series de tiempo se consideran una secuencia de cuádruples. Un cuádruple se define como (dispositivo, medida, tiempo, valor).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>medición</strong>: Una medida física o formal que toman los datos de una serie de tiempo, por ejemplo, la temperatura de una ciudad, el número de ventas de algunos bienes o la velocidad de un tren en diferentes momentos. Como un sensor tradicional (como un termómetro) también toma una sola medición y produce una serie de tiempo, usaremos medición y sensor indistintamente a continuación.</p>
</li>
<li>
<p><strong>dispositivo</strong>: un dispositivo se refiere a una entidad que toma varias medidas (produciendo múltiples series de tiempo), por ejemplo, un tren en marcha monitorea su velocidad, medidor de aceite, millas que ha corrido, cada uno de los pasajeros actuales es transportado a un conjunto de datos de series de tiempo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Una Línea de Datos</strong>: en muchas aplicaciones industriales, un dispositivo normalmente contiene más de un sensor y estos sensores pueden tener valores en la misma marca de tiempo, lo que se denomina una línea de datos.</p>
</div>
<div class="paragraph">
<p>Formalmente, una línea de datos consta de un <code>device_id</code>, una marca de tiempo que indica los milisegundos desde el 1 de enero de 1970, 00:00:00, y varios pares de datos compuestos por measurement_id y el <code>value</code> correspondiente. Todos los pares de datos de una línea pertenecen a este <code>device_id</code> y tienen la misma marca de tiempo. Si una de las <code>measurements</code> no tiene un <code>value</code> en la marca de tiempo, use un <code>timestamp</code> (en realidad, TsFile no almacena valores nulos). Su formato se muestra a continuación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>device_id, timestamp, &lt;measurement_id, value&gt;...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación se ilustra un ejemplo. En este ejemplo, el tipo de datos de dos medidas son <code>INT32</code>, <code>FLOAT</code> respectivamente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>device_1, 1490860659000, m1, 10, m2, 12.12</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_escribir_tsfile"><a class="anchor" href="#_escribir_tsfile"></a>Escribir TsFile</h4>
<div class="paragraph">
<p>Un TsFile se genera mediante los siguientes tres pasos y el código completo se proporciona en la sección "Ejemplo para escribir TsFile".</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Construir una instancia de <code>TsFileWriter</code>.</p>
<div class="paragraph">
<p>Estos son los constructores disponibles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sin esquema predefinido</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public TsFileWriter(File file) throws IOException</code></pre>
</div>
</div>
</li>
<li>
<p>Con esquema predefinido</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public TsFileWriter(File file, Schema schema) throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>Éste es para usar el sistema de archivos HDFS. <code>TsFileOutput</code> puede ser una instancia de la clase <code>HDFSOutput</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public TsFileWriter(TsFileOutput output, Schema schema) throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si desea establecer alguna configuración de TSFile por su cuenta, puede usar param <code>config</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TSFileConfig conf = new TSFileConfig();
conf.setTSFileStorageFs("HDFS");
TsFileWriter tsFileWriter = new TsFileWriter(file, schema, conf);</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este ejemplo, los archivos de datos se almacenarán en HDFS, en lugar del sistema de archivos local. Si desea almacenar archivos de datos en el sistema de archivos local, puede usar <code>conf.setTSFileStorageFs("LOCAL")</code>, que también es la configuración predeterminada.</p>
</div>
<div class="paragraph">
<p>También puede configurar el puerto ip y rpc de su HDFS mediante <code>config.setHdfsIp(&#8230;&#8203;)</code> y <code>config.setHdfsPort(&#8230;&#8203;)</code>. La ip predeterminada es <code>localhost</code> y el puerto rpc predeterminado es <code>9000</code>.</p>
</div>
<div class="paragraph">
<p><strong>Parámetros</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>file: TsFile para escribir</p>
</li>
<li>
<p>schema: Los esquemas de archivo se presentarán en la siguiente parte.</p>
</li>
<li>
<p>config: la configuración de TsFile.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Agregar medidas</p>
<div class="paragraph">
<p>O puede crear una instancia de la clase <code>Schema</code> primero y pasarla al constructor de la clase <code>TsFileWriter</code></p>
</div>
<div class="paragraph">
<p>La clase <code>Schema</code> contiene un mapa cuya clave es el nombre de un esquema de medición y el valor es el esquema en sí.</p>
</div>
<div class="paragraph">
<p>Aquí están las interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Create an empty Schema or from an existing map
public Schema()
public Schema(Map&lt;String, MeasurementSchema&gt; measurements)
// Use this two interfaces to add measurements
public void registerMeasurement(MeasurementSchema descriptor)
public void registerMeasurements(Map&lt;String, MeasurementSchema&gt; measurements)
// Some useful getter and checker
public TSDataType getMeasurementDataType(String measurementId)
public MeasurementSchema getMeasurementSchema(String measurementId)
public Map&lt;String, MeasurementSchema&gt; getAllMeasurementSchema()
public boolean hasMeasurement(String measurementId)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Siempre puede usar la siguiente interfaz en la clase <code>TsFileWriter</code> para agregar medidas adicionales:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public void addMeasurement(MeasurementSchema measurementSchema) throws WriteProcessException</code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <code>MeasurementSchema</code> contiene la información de una medición, hay varios constructores:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public MeasurementSchema(String measurementId, TSDataType type, TSEncoding encoding)
public MeasurementSchema(String measurementId, TSDataType type, TSEncoding encoding, CompressionType compressionType)
public MeasurementSchema(String measurementId, TSDataType type, TSEncoding encoding, CompressionType compressionType,
Map&lt;String, String&gt; props)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Parámetros</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>measurementID: el nombre de esta medición, normalmente el nombre del sensor.</p>
</li>
<li>
<p>type: el tipo de datos, ahora admite seis tipos: <code>BOOLEAN</code>, <code>INT32</code>, <code>INT64</code>, <code>FLOAT</code>, <code>DOUBLE</code>, <code>TEXT</code>;</p>
</li>
<li>
<p>encoding: la codificación de datos.</p>
</li>
<li>
<p>compression: La compresión de datos.</p>
</li>
<li>
<p>props: Propiedades para tipos de datos especiales, como <code>max_point_number</code> para <code>FLOAT</code> y <code>DOUBLE</code>, <code>max_string_length</code> para <code>TEXT</code>. Úselos como pares de cadenas en un mapa como ("max_point_number", "3").</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Aviso: aunque se puede utilizar un nombre de medición en varios deltaObjects, las propiedades no se pueden cambiar. Es decir. no se permite agregar un nombre de medición varias veces con diferentes tipos o codificaciones. He aquí un mal ejemplo:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> // The measurement "sensor_1" is float type
 addMeasurement(new MeasurementSchema("sensor_1", TSDataType.FLOAT, TSEncoding.RLE));

 // This call will throw a WriteProcessException exception
 addMeasurement(new MeasurementSchema("sensor_1", TSDataType.INT32, TSEncoding.RLE));</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Inserte y escriba datos continuamente.</p>
<div class="paragraph">
<p>Utilice esta interfaz para crear un nuevo <code>TSRecord</code> (una marca de tiempo y un par de dispositivos).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public TSRecord(long timestamp, String deviceId)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, cree un <code>DataPoint</code> (un par de valores y medidas) y utilice el método addTuple para agregar el DataPoint al TsRecord correcto.</p>
</div>
<div class="paragraph">
<p>Utilice este método para escribir</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public void write(TSRecord record) throws IOException, WriteProcessException</code></pre>
</div>
</div>
</li>
<li>
<p>Llame <code>close</code> para finalizar este proceso de escritura.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public void close() throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>También podemos escribir datos en un TsFile cerrado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utilice <code>ForceAppendTsFileWriter</code> para abrir un archivo cerrado.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public ForceAppendTsFileWriter(File file) throws IOException</code></pre>
</div>
</div>
</li>
<li>
<p>Llamar a `doTruncate`truncar la parte de los metadatos</p>
</li>
<li>
<p>Luego use <code>ForceAppendTsFileWriter</code> para construir un nuevo <code>TsFileWriter</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public TsFileWriter(TsFileIOWriter fileWriter) throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tenga en cuenta que debemos rehacer el paso de agregar medidas antes de escribir nuevos datos en el TsFile.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_para_escribir_un_tsfile"><a class="anchor" href="#_ejemplo_para_escribir_un_tsfile"></a>Ejemplo para Escribir un TsFile</h4>
<div class="paragraph">
<p>Debe instalar TsFile en su repositorio maven local.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -pl tsfile -am -DskipTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>Puede escribir un TsFile construyendo TSRecord si tiene datos de series de tiempo <strong>no alineados</strong> (por ejemplo, no todos los sensores contienen valores).</p>
</div>
<div class="paragraph">
<p>Puede encontrar un ejemplo más completo en <code>/example/tsfile/src/main/java/org/apache/iotdb/tsfile/TsFileWriteWithTSRecord.java</code></p>
</div>
<div class="paragraph">
<p>Puede escribir un TsFile construyendo <strong>Tablet</strong> si tiene los datos de series de tiempo alineados.</p>
</div>
<div class="paragraph">
<p>Puede encontrar un ejemplo más completo en <code>/example/tsfile/src/main/java/org/apache/iotdb/tsfile/TsFileWriteWithTablet.java</code></p>
</div>
<div class="paragraph">
<p>Puede escribir datos en un TsFile cerrado utilizando <strong>ForceAppendTsFileWriter</strong>.</p>
</div>
<div class="paragraph">
<p>Puede encontrar un ejemplo más completo en <code>/example/tsfile/src/main/java/org/apache/iotdb/tsfile/TsFileForceAppendWrite.java</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_interfaz_para_leer_tsfile"><a class="anchor" href="#_interfaz_para_leer_tsfile"></a>Interfaz para Leer TsFile</h4>
<div class="ulist">
<ul>
<li>
<p>Definición de Ruta</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Una ruta es una cadena separada por puntos que identifica de forma única una serie de tiempo en TsFile, por ejemplo, "root.area_1.device_1.sensor_1". La última sección "sensor_1" se llama "measurementId" mientras que las partes restantes "root.area_1.device_1" se llaman deviceId. Como se mencionó anteriormente, la misma medición en diferentes dispositivos tiene el mismo tipo de datos y codificación, y los dispositivos también son únicos.</p>
</div>
<div class="paragraph">
<p>En interfaces de lectura, los <code>paths</code> de los parámetros indican las medidas a seleccionar.</p>
</div>
<div class="paragraph">
<p>La instancia de ruta se puede construir fácilmente a través de la clase <code>Path</code>. Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Path p = new Path("device_1.sensor_1");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pasaremos una ArrayList de rutas para la llamada de consulta final para admitir múltiples rutas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>List&lt;Path&gt; paths = new ArrayList&lt;Path&gt;();
paths.add(new Path("device_1.sensor_1"));
paths.add(new Path("device_1.sensor_3"));</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Al construir una Ruta, el formato del parámetro debe ser una cadena separada por puntos, la última parte se reconocerá como measurementId  mientras que las partes restantes se reconocerán como deviceId.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Definición de Filtro</p>
</li>
<li>
<p>El Filtro de Escenario de Uso se utiliza en el proceso de lectura de TsFile para seleccionar datos que satisfacen una o más condiciones determinadas.</p>
</li>
<li>
<p>IExpression La <code>IExpression</code> es una interfaz de expresión de filtro y se pasará a nuestra última llamada de consulta. Creamos una o más expresiones de filtro y podemos usar operadores de filtro binarios para vincularlos a nuestra expresión final.</p>
</li>
<li>
<p>Crear una Expresión de Filtro</p>
<div class="paragraph">
<p>Hay dos tipos de filtros.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TimeFilter: un filtro de <code>time</code> en datos de series de tiempo.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Utilice las siguientes relaciones para obtener un objeto <code>TimeFilter</code> (value es una variable entera larga).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relación</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Descripción</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.eq(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo igual al valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.lt(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo menor que el valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.gt(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo mayor que el valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.ltEq(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo menor o igual que el valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.gtEq(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo mayor o igual que el valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.notEq(value)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo que no sea igual al valor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeFilter.not(TimeFilter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elija el tiempo que no satisfaga otro TimeFilter</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>ValueFilter: un filtro de valor en datos de series de tiempo.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression valueFilterExpr = new SingleSeriesExpression(Path, ValueFilter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>El uso de <code>ValueFilter</code> es el mismo que el de <code>TimeFilter</code>, solo para asegurarse de que el tipo de valor sea igual al de la medición (definido en la ruta).</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Operadores de Filtros Binarios</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los operadores de filtro binario se pueden utilizar para vincular dos expresiones individuales.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BinaryExpression.and(Expression, Expression): Elija el valor satisfactorio para ambas expresiones.</p>
</li>
<li>
<p>BinaryExpression.or(Expression, Expression): elija el valor satisfactorio para al menos una expresión.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ejemplos de Expresiones de Filtro</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ejemplos de TimeFilterExpression</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter.eq(15)); // series time = 15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter.ltEq(15)); // series time &lt;= 15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter.lt(15)); // series time &lt; 15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter.gtEq(15)); // series time &gt;= 15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = new GlobalTimeExpression(TimeFilter.notEq(15)); // series time != 15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = BinaryExpression.and(new GlobalTimeExpression(TimeFilter.gtEq(15L)),
                                         new GlobalTimeExpression(TimeFilter.lt(25L))); // 15 &lt;= series time &lt; 25</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>IExpression timeFilterExpr = BinaryExpression.or(new GlobalTimeExpression(TimeFilter.gtEq(15L)),
                                         new GlobalTimeExpression(TimeFilter.lt(25L))); // series time &gt;= 15 or series time &lt; 25</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Leer Interfaz</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Primero, abrimos TsFile y obtenemos una instancia de <code>ReadOnlyTsFile</code> de una ruta de archivo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TsFileSequenceReader reader = new TsFileSequenceReader(path);

ReadOnlyTsFile readTsFile = new ReadOnlyTsFile(reader);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, preparamos la matriz de ruta y la expresión de consulta, luego obtenemos el objeto <code>QueryExpression</code> final mediante esta interfaz:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>QueryExpression queryExpression = QueryExpression.create(paths, statement);</code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <code>ReadOnlyTsFile</code> tiene dos métodos de <code>query</code> para realizar una consulta.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Método 1</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public QueryDataSet query(QueryExpression queryExpression) throws IOException</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Método 2</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public QueryDataSet query(QueryExpression queryExpression, long partitionStartOffset, long partitionEndOffset) throws IOException</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
Este método está diseñado para aplicaciones avanzadas como TsFile-Spark Connector.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>params: para el método 2, se agregan dos parámetros adicionales para admitir consultas parciales:</p>
<div class="ulist">
<ul>
<li>
<p><code>particiónStartOffset</code>: inicio de desplazamiento para un TsFile</p>
</li>
<li>
<p><code>particiónEndOffset</code>: desplazamiento final para un TsFile</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>¿Qué es Consulta Parcial?</p>
</div>
<div class="paragraph">
<p>En algunos sistemas de archivos distribuidos (por ejemplo, HDFS), un archivo se divide en varias partes que se denominan "Bloques" y se almacenan en diferentes nodos. La ejecución de una consulta en paralelo en cada uno de los nodos involucrados mejora la eficiencia. Por lo tanto, se necesita una consulta parcial. Paritial Query solo selecciona los resultados almacenados en la parte dividida por <code>QueryConstant.PARTITION_START_OFFSET</code> y <code>QueryConstant.PARTITION_END_OFFSET</code> para un TsFile.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Interfaz QueryDataset</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>La consulta realizada anteriormente devolverá un objeto <code>QueryDataset</code>.</p>
</div>
<div class="paragraph">
<p>Aquí están las interfaces útiles para el usuario.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bool hasNext();</code></p>
<div class="paragraph">
<p>Devuelve true si este conjunto de datos todavía tiene elementos.</p>
</div>
</li>
<li>
<p><code>List&lt;Path&gt; getPaths()</code></p>
<div class="paragraph">
<p>Obtenga las rutas en este conjunto de datos.</p>
</div>
</li>
<li>
<p><code>List&lt;TSDataType&gt; getDataTypes();</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obtenga los tipos de datos. La clase TSDataType es una clase de enumeración, el valor será uno de los siguientes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>   BOOLEAN,
   INT32,
   INT64,
   FLOAT,
   DOUBLE,
   TEXT;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RowRecord next() throws IOException;</code></p>
<div class="paragraph">
<p>Obtiene el siguiente registro.</p>
</div>
<div class="paragraph">
<p>La clase <code>RowRecord</code> consta de una marca de tiempo <code>long</code> y una <code>List&lt;Field&gt;</code> para datos en diferentes sensores, podemos usar dos métodos getter para obtenerlos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>long getTimestamp();
List&lt;Field&gt; getFields();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para obtener datos de un campo, utilice estos métodos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TSDataType getDataType();
Object getObjectValue();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ejemplo_para_leer_un_tsfile_existente"><a class="anchor" href="#_ejemplo_para_leer_un_tsfile_existente"></a>Ejemplo para Leer un TsFile Existente</h4>
<div class="paragraph">
<p>Debe instalar TsFile en su repositorio maven local.</p>
</div>
<div class="paragraph">
<p>Puede encontrar un ejemplo más completo con la declaración de consulta en <code>/tsfile/example/src/main/java/org/apache/iotdb/tsfile/TsFileRead.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Java hljs" data-lang="Java">package org.apache.iotdb.tsfile;
import java.io.IOException;
import java.util.ArrayList;
import org.apache.iotdb.tsfile.read.ReadOnlyTsFile;
import org.apache.iotdb.tsfile.read.TsFileSequenceReader;
import org.apache.iotdb.tsfile.read.common.Path;
import org.apache.iotdb.tsfile.read.expression.IExpression;
import org.apache.iotdb.tsfile.read.expression.QueryExpression;
import org.apache.iotdb.tsfile.read.expression.impl.BinaryExpression;
import org.apache.iotdb.tsfile.read.expression.impl.GlobalTimeExpression;
import org.apache.iotdb.tsfile.read.expression.impl.SingleSeriesExpression;
import org.apache.iotdb.tsfile.read.filter.TimeFilter;
import org.apache.iotdb.tsfile.read.filter.ValueFilter;
import org.apache.iotdb.tsfile.read.query.dataset.QueryDataSet;

/**
 * The class is to show how to read TsFile file named "test.tsfile".
 * The TsFile file "test.tsfile" is generated from class TsFileWrite.
 * Run TsFileWrite to generate the test.tsfile first
 */
public class TsFileRead {
  private static void queryAndPrint(ArrayList&lt;Path&gt; paths, ReadOnlyTsFile readTsFile, IExpression statement)
          throws IOException {
    QueryExpression queryExpression = QueryExpression.create(paths, statement);
    QueryDataSet queryDataSet = readTsFile.query(queryExpression);
    while (queryDataSet.hasNext()) {
      System.out.println(queryDataSet.next());
    }
    System.out.println("------------");
  }

  public static void main(String[] args) throws IOException {

    // file path
    String path = "test.tsfile";

    // create reader and get the readTsFile interface
    TsFileSequenceReader reader = new TsFileSequenceReader(path);
    ReadOnlyTsFile readTsFile = new ReadOnlyTsFile(reader);
    // use these paths(all sensors) for all the queries
    ArrayList&lt;Path&gt; paths = new ArrayList&lt;&gt;();
    paths.add(new Path("device_1.sensor_1"));
    paths.add(new Path("device_1.sensor_2"));
    paths.add(new Path("device_1.sensor_3"));

    // no query statement
    queryAndPrint(paths, readTsFile, null);

    //close the reader when you left
    reader.close();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cambiar_la_configuración_de_tsfile"><a class="anchor" href="#_cambiar_la_configuración_de_tsfile"></a>Cambiar la Configuración de TsFile</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TSFileConfig config = TSFileDescriptor.getInstance().getConfig();
config.setXXX();</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Esta página fue hecha usando la interfaz predeterminada de Antora.</p>
  <p>El código de esta interfaz está licenciado bajo los términos de la licencia MPL-2.0.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
